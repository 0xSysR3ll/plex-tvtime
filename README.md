<div align="center"><img height="200px" alt="logo" src="src/main/resources/static/favicon.png?raw=true"/></div>

## <div align="right"><a href="https://www.buymeacoffee.com/zggis" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/default-orange.png" alt="Buy Me A Coffee" height="41" width="174"></a></div>

### Description
Plex-TVTime is a Plex webhook handler that automatically updates your TVTime watch history. TV episodes are automatically marked as watched once you complete them on Plex.

### Installing
#### Unraid
To install Plex-TVTime on Unraid you can install the docker container through the community applications.
#### Docker Desktop
You can run Plex-TVTime on Docker locally by using the following command. Replace CONFIG with the directory you want the database to be saved to, and any other directories that contain your log files.
```
$ docker run -e TVTIME_USER={Your TVTime username} -e TVTIME_PASSWORD={Your TVTime password} -e PLEX_USERS={Plex username(s) to link} -p 8080:8080 zggis/plex-tvtime:latest
```

### Usage
Navigating to the home page http://[host]:[port] in your browser will display the webhook URL you can enter in Plex > Settings > Webhooks. It should be http://[host]:[port]/webhook/plex<br><br>
Plex-TVTime will mark episodes as watched on your TVTime profile once you have watched them passed the configured 'Video played threshold' in Plex (You can adjust this % in Plex Settings > Library). Plex <strong>does not</strong> send webhooks when episodes are manaully marked as watched.<br><br>
Only libraries of type 'TV Shows' will be considered by Plex-TVTime, so it will ignore webhooks generated by movies and other libraries.<br><br>
Watching an episode for a show that has not been added to you TVTime profile will automatically add the show. If this behavior is undesired, you can make use of the Excluded/Included configuration parameters below to restrict which shows are sent to TVTime.<br><br>
Watching an episode for a show you have already marked as watched in TVTime has no effect, the episode is not marked as 'rewatched' in TVTime, nor is the time you first marked the episode as watched updated.<br><br>
As of v1.1.0 Plex-TVTime supports linking multiple TVTime accounts through advanced configuration. <a href="https://github.com/Zggis/plex-tvtime#linking-multiple-tvtime-accounts-only-available-in-v110">See details below.</a>

### Basic Configuration

#### Required Variables
Name | Description
--- | ---
TVTIME_USER | The username you use to login to TVTime.
TVTIME_PASSWORD | The password you use to login to TVTime.
PLEX_USERS | Single Plex user or comma separated list of users whoes watch events will be sent to TVTime.

#### Optional Variables
Container Variable | Default Value | Description
--- | --- | ---
PLEX_SHOWS_EXCLUDE | Undefined | A comma separated list of TV show titles that will not be sent to TVTime. TVShow title should be identicle to how it appears in your Plex library. If the title includes a comma in it replace it with %2C to avoid conflicting with the comma delimeters in the list.
PLEX_SHOWS_INCLUDE | Undefined | Overridden and ignored if PLEX_SHOWS_EXCLUDE is set, otherwise only shows that appear in this list will be sent to TVTime.
LOGGING_LEVEL | INFO | Set to TRACE or DEBUG for additional logging.

#### Linking Multiple TVTime Accounts (Only available in v1.1.0+)
To link multiple TVTime accounts you can create a YAML configuration file following the template here. YAML files are very sensitive to format so make sure you use a text editor that can preserve tabs, spaces, and line endings.<br><br>
You will need to mount the directory location of your YAML file to the docker container. In Unraid you can add a Path to the configuration, on docker command line you can follow the example below.<br><br>
Lastly you will need to pass in a environment variable SPRING_CONFIG_LOCATION with the container relevant path of the YAML.<br><br>
```
$ docker run -e SPRING_CONFIG_LOCATION=/config -v "C:/full/path/to/application.yaml":/config -p 8080:8080 zggis/plex-tvtime:latest
```
The application.yaml file replaces all other configuration, so you no longer need to pass in any of the basic configuration as environment variables, you can set them directly in application.yaml. If you still want to use enviornment variables you can reference them in application.yaml with ${YOUR_ENVIRONMENT_VAR}<br><br>
If you are using the docker compose file, you will need to specify SPRING_CONFIG_LOCATION and the needed mount in your .env file.

### Troubleshooting
Please check the logs, as described above many webhook events are intentionally ignored depending on configuration. If you can't resolve on your own open an <a href="https://github.com/Zggis/plex-tvtime/issues/new">issue</a> and I will help. If you open an issue please set the LOGGING_LEVEL to TRACE and include the relevant logs in your issue, the app does not create its own logfile, so you can just copy them from the console logs.

### FAQ
**Question:** What about movies?

**Answer:** I tried to get movies working as I know the TVTime mobile app supports tracking movies, however the website does not seem to support this. TVTime does not publish a public api so I had to rely on scraping the website which left me with no way to incorporate movies.
